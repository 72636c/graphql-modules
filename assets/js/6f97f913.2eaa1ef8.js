(window.webpackJsonp=window.webpackJsonp||[]).push([[26],{134:function(e,n,t){"use strict";t.r(n),t.d(n,"frontMatter",(function(){return s})),t.d(n,"metadata",(function(){return o})),t.d(n,"toc",(function(){return c})),t.d(n,"default",(function(){return l}));var r=t(3),i=t(9),a=(t(0),t(166)),s={id:"microservices",title:"Microservices",sidebar_label:"Microservices"},o={unversionedId:"recipes/microservices",id:"version-legacy/recipes/microservices",isDocsHomePage:!1,title:"Microservices",description:"Exposing Unified Schema",source:"@site/versioned_docs/version-legacy/recipes/microservices.md",slug:"/recipes/microservices",permalink:"/docs/legacy/recipes/microservices",editUrl:"https://github.com/Urigo/graphql-modules/edit/master/website/versioned_docs/version-legacy/recipes/microservices.md",version:"legacy",sidebar_label:"Microservices",sidebar:"version-legacy/docs",previous:{title:"Communication Between Modules",permalink:"/docs/legacy/recipes/communication-between-modules"},next:{title:"Fetch External Data Using Data Sources",permalink:"/docs/legacy/recipes/data-sources"}},c=[{value:"Exposing Unified Schema",id:"exposing-unified-schema",children:[]},{value:"Communication Between Servers",id:"communication-between-servers",children:[{value:"Redis PubSub",id:"redis-pubsub",children:[]},{value:"Existing Implementations for PubSub",id:"existing-implementations-for-pubsub",children:[]}]}],b={toc:c};function l(e){var n=e.components,t=Object(i.a)(e,["components"]);return Object(a.b)("wrapper",Object(r.a)({},b,t,{components:n,mdxType:"MDXLayout"}),Object(a.b)("h2",{id:"exposing-unified-schema"},"Exposing Unified Schema"),Object(a.b)("p",null,"If you wish to separate your server to smaller parts and deploy them as microservices, you can use GraphQL Modules in the way you are used to."),Object(a.b)("p",null,"That means that you can still implement small servers and then use ",Object(a.b)("strong",{parentName:"p"},"Schema Stitching")," to merge your small GraphQL schemas into a unified schema."),Object(a.b)("h2",{id:"communication-between-servers"},"Communication Between Servers"),Object(a.b)("p",null,"You can also use ",Object(a.b)("strong",{parentName:"p"},Object(a.b)("a",{parentName:"strong",href:"https://www.apollographql.com/docs/apollo-server/features/subscriptions.html#PubSub-Implementations"},Object(a.b)("inlineCode",{parentName:"a"},"PubSub")))," to implement messaging mechanism between GraphQL Modules servers."),Object(a.b)("p",null,"The default and built-in implementation of the ",Object(a.b)("inlineCode",{parentName:"p"},"PubSub")," uses ",Object(a.b)("inlineCode",{parentName:"p"},"EventEmitter"),".\nSince it's a very simple API, you can implement your own way of sending messages."),Object(a.b)("p",null,"You can implement your own message transmitter by implementing ",Object(a.b)("inlineCode",{parentName:"p"},"PubSub")," interface:"),Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre",className:"language-typescript"},"export class MyPubSub {\n  subscribe<T = any>(event: string, handler: (payload: T) => void): { unsubscribe: () => void } {\n    // 1. You need to keep a record between the event and the handler\n\n    return {\n      unsubscribe: () => y{\n        // 2. Here you need to implement the logic for unsubscribing for the event\n      },\n    };\n  }\n\n  publish<T = any>(event: string, payload: T): void {\n    // 3. Here you need to implement to logic for publishing a new message\n  }\n}\n")),Object(a.b)("p",null,"Make sure to use it in a ",Object(a.b)("inlineCode",{parentName:"p"},"GraphQLModule")," declaration:"),Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre",className:"language-typescript"},"import { GraphQLModule } from '@graphql-modules/core';\n\nconst CommunicationModule = new GraphQLModule({\n  provider: [MyPubSub],\n  /* ... */\n});\n")),Object(a.b)("p",null,"Finally, import ",Object(a.b)("inlineCode",{parentName:"p"},"CommunicationModule")," to all other modules where you wish to use ",Object(a.b)("inlineCode",{parentName:"p"},"PubSub"),"."),Object(a.b)("h3",{id:"redis-pubsub"},"Redis PubSub"),Object(a.b)("p",null,"Another useful trick is to use external PubSub services such as ",Object(a.b)("strong",{parentName:"p"},Object(a.b)("a",{parentName:"strong",href:"https://redis.io/topics/pubsub"},"Redis PubSub")),"."),Object(a.b)("p",null,"You can easily create a ",Object(a.b)("inlineCode",{parentName:"p"},"RedisPubSub")," this way:"),Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre",className:"language-typescript"},"import * as redis from 'redis';\n\nexport class PubSub {\n  _client = null;\n\n  constructor() {\n    this._client = redis.createClient();\n  }\n\n  subscribe<T = any>(\n    event: string,\n    handler: (payload: T) => void\n  ): { unsubscribe: () => void } {\n    this._client.subscribe(event);\n\n    this._client.on('message', function (channel, message) {\n      if (channel !== event) {\n        return;\n      }\n\n      handler(JSON.parse(message));\n    });\n\n    return {\n      unsubscribe: () => {\n        this._client.unsubscribe(event);\n      },\n    };\n  }\n\n  publish<T = any>(event: string, payload: T): void {\n    this._client.publish(event, JSON.stringify(payload));\n  }\n}\n")),Object(a.b)("h3",{id:"existing-implementations-for-pubsub"},"Existing Implementations for PubSub"),Object(a.b)("p",null,Object(a.b)("inlineCode",{parentName:"p"},"PubSub")," can be replaced by other implementations.\nThe following are existing ready-to-use implementations:"),Object(a.b)("ul",null,Object(a.b)("li",{parentName:"ul"},Object(a.b)("strong",{parentName:"li"},Object(a.b)("a",{parentName:"strong",href:"https://github.com/davidyaha/graphql-redis-subscriptions"},"Redis"))),Object(a.b)("li",{parentName:"ul"},Object(a.b)("strong",{parentName:"li"},Object(a.b)("a",{parentName:"strong",href:"https://github.com/axelspringer/graphql-google-pubsub"},"Google PubSub"))),Object(a.b)("li",{parentName:"ul"},Object(a.b)("strong",{parentName:"li"},Object(a.b)("a",{parentName:"strong",href:"https://github.com/davidyaha/graphql-mqtt-subscriptions"},"MQTT enabled broker"))),Object(a.b)("li",{parentName:"ul"},Object(a.b)("strong",{parentName:"li"},Object(a.b)("a",{parentName:"strong",href:"https://github.com/cdmbase/graphql-rabbitmq-subscriptions"},"RabbitMQ"))),Object(a.b)("li",{parentName:"ul"},Object(a.b)("strong",{parentName:"li"},Object(a.b)("a",{parentName:"strong",href:"https://github.com/ancashoria/graphql-kafka-subscriptions"},"Kafka"))),Object(a.b)("li",{parentName:"ul"},Object(a.b)("strong",{parentName:"li"},Object(a.b)("a",{parentName:"strong",href:"https://github.com/GraphQLCollege/graphql-postgres-subscriptions"},"Postgres")))))}l.isMDXComponent=!0},166:function(e,n,t){"use strict";t.d(n,"a",(function(){return u})),t.d(n,"b",(function(){return d}));var r=t(0),i=t.n(r);function a(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function s(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function o(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?s(Object(t),!0).forEach((function(n){a(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):s(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function c(e,n){if(null==e)return{};var t,r,i=function(e,n){if(null==e)return{};var t,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)t=a[r],n.indexOf(t)>=0||(i[t]=e[t]);return i}(e,n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)t=a[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(i[t]=e[t])}return i}var b=i.a.createContext({}),l=function(e){var n=i.a.useContext(b),t=n;return e&&(t="function"==typeof e?e(n):o(o({},n),e)),t},u=function(e){var n=l(e.components);return i.a.createElement(b.Provider,{value:n},e.children)},p={inlineCode:"code",wrapper:function(e){var n=e.children;return i.a.createElement(i.a.Fragment,{},n)}},m=i.a.forwardRef((function(e,n){var t=e.components,r=e.mdxType,a=e.originalType,s=e.parentName,b=c(e,["components","mdxType","originalType","parentName"]),u=l(t),m=r,d=u["".concat(s,".").concat(m)]||u[m]||p[m]||a;return t?i.a.createElement(d,o(o({ref:n},b),{},{components:t})):i.a.createElement(d,o({ref:n},b))}));function d(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var a=t.length,s=new Array(a);s[0]=m;var o={};for(var c in n)hasOwnProperty.call(n,c)&&(o[c]=n[c]);o.originalType=e,o.mdxType="string"==typeof e?e:r,s[1]=o;for(var b=2;b<a;b++)s[b]=t[b];return i.a.createElement.apply(null,s)}return i.a.createElement.apply(null,t)}m.displayName="MDXCreateElement"}}]);